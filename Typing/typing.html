<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Typing Game</title>
<script type="text/javascript" src="lib/jquery.js"></script>
<script type="text/javascript" src="lib/jquery.alerts.js"></script>
<link rel="stylesheet" href="css/jquery.alerts.css" type="text/css" />
<script language="javascript">
	
	var successful_count = 0;		//成功数
	var failure_count = 0;			//失敗数
	var count = 1;					//問題数
	var combo = 0;					//コンボ数（成功単語数）
	var MaxCombo = 0;				//最大コンボ数
	var TimerStart = 60;          	//タイマの開始値 デフォルト６０
	var Timer      = TimerStart   	//カウントダウンタイマ
	var Wait       = 1000;        	//待ち時間（ミリ秒）
	var index;					  	//語句配列用変数
	var conboFlag = true;			//単語入力中にミスをした場合、その単語を打ち終わってもcomboは発動しないため
	var TimerFlag = true;			//タイマーが動いているか管理（true：停止　false：動作）
	var ResetFlag = true;			//リセットボタンが押されたか管理

	//問題配列
	var typeTargets = new Array(				
 		"STRAWBERRY", "ORANGE","CHERRY","BANANA","APPLE",
		"GRAPEFRUIT","PINEAPPLE","WATERMELON","GRAPE","RASPBERRY",
		"BLUEBERRY","MUSCAT","MELON","PEACH","LEMON",
		"COCONUT","DURIAN","PAPAYA","MUSKMELON","MANGO",
		"AVOCADO","APRICOT","KIWI","YUZU","LIME",
		"AYEAYE","RACCOON","ARMADILLO","DOG","RABBIT","HORSE",
		"BULL","WOLF","ORANGUTAN","ROOSTER","HIPPOPOTAMUS",
		"PLATYPUS","KANGAROO","FOX","GIRAFFE","BEAR","KOALA",
		"PUPPY","KITTEN","COYOTE","GORILLA","RHINOCEROS",
		"MONKEY","DEER","SIAMESE CAT","ZEBRA","CHIPMUNK",
		"BUFFALO","SKUNK","ELEPHANT","CHIMPANZEE",
		"DOBERMAN PINSCHER","RAT","TIGER","SLOTH","COW",
		"CAT","HYENA","MOUSE","HAMSTER","HEDGEHOG",
		"PANDA","BEAVER","SHEEP","BABOON","LEOPARD",
		"FERRET","OPOSSUM","PIG","PRAIRIE DOG","HEN","MOLE",
		"GUINEA PIG","GOAT","PORCUPINE","LION","CAMEL","LLAMA",
		"SQUIRREL","DONKEY"
	);
	
	//問題の日本語訳配列
	var typeTargetsJapanese = new Array(				
 		"いちご", "みかん","さくらんぼ","ばなな","りんご",
		"グレープフルーツ","パイナップル","スイカ","ぶどう","ラズベリー",
		"ブルーベリー","マスカット","メロン","もも","レモン",
		"ココナッツ","ドリアン","パパイヤ","マスクメロン","マンゴー",
		"アボカド","アプリコット","キウイ","ゆず","ライム",
		"アイアイ","アライグマ","アルマジロ","犬","うさぎ","馬",
		"雄牛","オオカミ","オランウータン","雄鶏","カバ",
		"カモノハシ","カンガルー","キツネ","キリン","熊","コアラ",
		"子犬","子猫","コヨーテ","ゴリラ","サイ",
		"猿","シカ","シャムネコ","シマウマ","シマリス",
		"スイギュウ","スカンク","ゾウ","チンパンジー",
		"ドーベルマン","ネズミ","トラ","ナマケモノ","乳牛",
		"ネコ","ハイエナ","ハツカネズミ","ハムスター","ハリネズミ",
		"パンダ","ビーバー","ヒツジ","ヒヒ","ヒョウ",
		"フェレット","フクロネズミ","豚","プレーリードッグ","雌鳥","モグラ",
		"モルモット","ヤギ","ヤマアラシ","ライオン","ラクダ","ラマ",
		"リス","ロバ"
	);
	
	//変数初期化と表示
	function hensu_sengen(){
		word.innerHTML = "sample";						//乱数で選ばれた問題配列の中の１つをラベルに
		jp_word.innerHTML = "サンプル";					//日本語
		input_word.innerHTML = "★";
		$('#input_word').hide();
		Timer = 0;
		combo = 0;
		count = 1;
  		q_num.innerHTML = count;
		combocount.innerHTML = combo; 
		success.innerHTML = successful_count;
  		failed.innerHTML = failure_count;
		maxCombo.innerHTML = MaxCombo;
	}
	
	//初期状態とリセットボタンが押されたとき
	function init() {
		hensu_sengen();
		successful_count = 0;	/*	この３つは				*/
		failure_count = 0;		/*	hensu_sengen()に書くと	*/
		MaxCombo = 0;			/*	resultが間抜けになる	*/
		clearTimeout();
		TimerFlag = true;
		ResetFlag = false;
	}

	//キーが押されたときの処理
	function keyDown() {
		var text = word.innerHTML;	
		var text2 = jp_word.innerHTML;				
		var code = text.substring(0,1);					//text（問題）の１文字目の文字コードを参照
		var chr = String.fromCharCode(event.keyCode);	//入力されたキーコードを文字列に
		var input = chr;
		input_word.innerHTML = 	input;
		if(Timer >= 0 && TimerFlag == false){			//まだ時間が残っているか
			if (chr == code) {							//押されたキーとcode（正解）が真か
    			$('#input_word').hide();
				text = text.substring(1, text.length);	//text（問題）の２文字目から最後までを代入
    			if (text.length == 0) {					//text（問題）の長さが０なら
					if(conboFlag == false){			
						combo = 0;	
					}else{
						combo++;	
						if(combo % 5 == 0){				//コンボ数が５で割り切れると３秒追加
							Timer = Timer + 3;
							time_plus.innerHTML = "＋３秒";
							$("#time_plus").fadeIn(500);
							$("#time_plus").fadeOut(3000);
						}
						if(combo > MaxCombo){			//コンボ数更新
							MaxCombo = combo;
							maxCombo.innerHTML = MaxCombo;	
						}
					}
					text = next();						//次の問題を作る
					text2 = next2();					//次の問題を作る(日本語)
					count++;	
					conboFlag = true;
				}
    		word.innerHTML = text;						//問題を表示
			jp_word.innerHTML = text2;  				//問題を表示(日本語)
    		successful_count++;							//正解数
  			}else if (chr != code){					//打ち間違い時の処理
				$('#input_word').show();				//間違って打った文字を表示
  				failure_count++;						//失敗数
				combo = 0;
				conboFlag = false;						//コンボリセット
			}
		}
	
		combocount.innerHTML = combo;					//コンボ数を更新
  		success.innerHTML = successful_count;			//正解数を更新
  		failed.innerHTML = failure_count;				//失敗数を更新
   		q_num.innerHTML = count;						//問題数を更新
	}

	//次の問題を作る	
	function next() {
		index = Math.floor(Math.random() * (typeTargets.length - 1));	//乱数生成
  		return typeTargets[index];										//問題配列[乱数]
	}
	
	//次の問題を作る(日本語)
	function next2() {	
		var index2 = index;
		return typeTargetsJapanese[index2];								//日本語の問題配列[乱数]
	}
	
	//タイマースタート
	function hogeStart() {
		if(TimerFlag == true){
			hensu_sengen();		
			successful_count = 0;	/*	この３つは				*/
			failure_count = 0;		/*	hensu_sengen()に書くと	*/
			MaxCombo = 0;			/*	resultが間抜けになる	*/
			word.innerHTML = next();						//乱数で選ばれた問題配列の中の１つをラベルに
			jp_word.innerHTML = next2();					//日本語
	    	Timer = TimerStart;
			TimerFlag = false;
			ResetFlag = true;
    		setTimeout(hogeCountDown, Wait);
		}else{
			//タイマーフラグがたってるから何もしない（スタートボタン連打対策）
		}
	}
	
	//カウントダウン
	function hogeCountDown() {
   		if (Timer <= 0) {
			TimerFlag = true;
			time.innerHTML = '0';
        	clearTimeout();
			timeUp();										//アラート表示
    	} else {
			time.innerHTML = Timer--;
        	setTimeout(hogeCountDown, Wait);
    }
	
	//タイムアップ
	function timeUp(){
		if(TimerFlag == true && ResetFlag == true){
			$("#result").fadeIn(3000);
			success.innerHTML = successful_count;
			failed.innerHTML = failure_count;
			maxCombo.innerHTML = MaxCombo;
			
			jAlert('ゲーム終了だぞｍ9っ｀Д´)', 'ゲーム終了！');
		
			$('#btn_result').click(function(){
				$('#result').fadeOut(1000);
				hensu_sengen();
			});
		}
	}		

}
</script>
<link href="css/TypingGame.css" rel="stylesheet" type="text/css">
<link href="css/bootstrap.min.css" rel="stylesheet" type="text/css">
</head>

<body onkeydown="keyDown()" onLoad="init()">

	<!--ゲーム画面全体ここから-->
	<div id="game_wrap">
       
   		<!-- 吹き出しここから -->
   		<div class="speech_buble">
     
    		<div id="div_time">
      			あと <span id="time">0</span> 秒！
        		<span id="time_plus"></span>
      		</div>
     	
			<div id="div_combo">
    			<span id="combocount">0</span> コンボ！
			</div>
    
		</div>
     	<!-- 吹き出しここまで -->
    
    
    	<!--問題数の表示ここから-->
		<div id="question">
    		<div id="dai">第</div>
      		<div id="q_num"></div>
      		<div id="mon">問</div>
   		</div>
    	<!--問題数の表示ここまで-->
    
	    <!--単語の表示ここから-->
		<div id="word_box">
    		<!--↓idを指定して単語を入れ替え（日本語）-->
    		<div id="jp_word"></div>
    		<!--英語-->
    		<span id="word"></span>
            <!--入力文字-->
    		<div id="input_word"></div>
		</div>
    	<!--単語の表示ここまで-->
     
		<!--ボタンここから-->
     	<div id="button_left">
      		<a><button id="btn_start" onClick="hogeStart()">
            <i class="icon-white icon-play"></i> 　スタート　</button></a>
		</div>
        
     	<div id="button_right">
     		<a><button id="btn_reset" onClick="init()">
            <i class="icon-white icon-repeat"></i> 　リセット　</button></a>
     	</div>
    	<!--ボタンここまで-->
	
    </div>
	<!--ゲーム画面全体ここまで-->
  
	<!--入力結果の表示ここから-->
  	<div id="result">
    	<div class="box_result">
      		<li>成功数：<span id="success">0</span></li>
  	    	<li>失敗数：<span id="failed">0</span></li>
    		<li>最大コンボ数：<span id="maxCombo">0</span></li>
        	<li><button id="btn_result" onClick="result()">ＯＫ</button></li>  
    	</div>
    </div>
	<!--入力結果の表示ここまで-->

</body>
</html>